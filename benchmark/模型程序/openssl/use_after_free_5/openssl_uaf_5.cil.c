/* Generated by CIL v. 1.7.3 */
/* print_CIL_Input is true */

#line 216 "/usr/lib/gcc/x86_64-linux-gnu/5/include/stddef.h"
typedef unsigned long size_t;
#line 380 "../openssl.h"
struct ssl_st;
#line 380 "../openssl.h"
typedef struct ssl_st SSL;
#line 12 "openssl_uaf_5.c"
struct _pitem {
   unsigned char priority[8] ;
   void *data ;
   struct _pitem *next ;
};
#line 12 "openssl_uaf_5.c"
typedef struct _pitem pitem;
#line 19 "openssl_uaf_5.c"
struct _pqueue {
   pitem *items ;
   int count ;
};
#line 19 "openssl_uaf_5.c"
typedef struct _pqueue pqueue_s;
#line 25 "openssl_uaf_5.c"
typedef struct _pqueue *pqueue;
#line 26 "openssl_uaf_5.c"
struct record_pqueue_st {
   unsigned short epoch ;
   pqueue q ;
};
#line 26 "openssl_uaf_5.c"
typedef struct record_pqueue_st record_pqueue;
#line 32 "openssl_uaf_5.c"
struct ssl3_record_st {
   int type ;
   unsigned int length ;
   unsigned int orig_len ;
   unsigned int off ;
   unsigned char *data ;
   unsigned char *input ;
   unsigned char *comp ;
   unsigned long epoch ;
   unsigned char seq_num[8] ;
};
#line 32 "openssl_uaf_5.c"
typedef struct ssl3_record_st SSL3_RECORD;
#line 48 "openssl_uaf_5.c"
struct ssl3_buffer_st {
   unsigned char *buf ;
   size_t len ;
   int offset ;
   int left ;
};
#line 48 "openssl_uaf_5.c"
typedef struct ssl3_buffer_st SSL3_BUFFER;
#line 57 "openssl_uaf_5.c"
struct ssl3_state_st {
   SSL3_BUFFER rbuf ;
   SSL3_RECORD rrec ;
};
#line 62 "openssl_uaf_5.c"
struct ssl_st {
   struct ssl3_state_st *s3 ;
   unsigned char *packet ;
   unsigned int packet_length ;
};
#line 69 "openssl_uaf_5.c"
struct dtls1_record_data_st {
   unsigned char *packet ;
   unsigned int packet_length ;
   SSL3_BUFFER rbuf ;
   SSL3_RECORD rrec ;
};
#line 69 "openssl_uaf_5.c"
typedef struct dtls1_record_data_st DTLS1_RECORD_DATA;
#line 362 "/usr/include/stdio.h"
extern int printf(char const   * __restrict  __format  , ...) ;
#line 466 "/usr/include/stdlib.h"
extern  __attribute__((__nothrow__)) void *( __attribute__((__leaf__)) malloc)(size_t __size )  __attribute__((__malloc__)) ;
#line 483
extern  __attribute__((__nothrow__)) void ( __attribute__((__leaf__)) free)(void *__ptr ) ;
#line 83 "openssl_uaf_5.c"
extern int ( /* missing proto */  memcpy)() ;
#line 77 "openssl_uaf_5.c"
pitem *pitem_new(unsigned char *prio64be , void *data ) 
{ 
  pitem *item ;
  void *tmp ;

  {
#line 80
  tmp = malloc(sizeof(pitem ));
#line 80
  item = (pitem *)tmp;
#line 81
  if ((unsigned long )item == (unsigned long )((void *)0)) {
#line 81
    return ((pitem *)((void *)0));
  }
#line 83
  memcpy(item->priority, prio64be, sizeof(item->priority));
#line 85
  item->data = data;
#line 86
  item->next = (struct _pitem *)((void *)0);
#line 88
  return (item);
}
}
#line 91 "openssl_uaf_5.c"
void pitem_free(pitem *item ) 
{ 


  {
#line 94
  if ((unsigned long )item == (unsigned long )((void *)0)) {
#line 94
    return;
  }
#line 96
  free((void *)item);
#line 97
  return;
}
}
#line 105
extern int ( /* missing proto */  memset)() ;
#line 99 "openssl_uaf_5.c"
pqueue_s *pqueue_new(void) 
{ 
  pqueue_s *pq ;
  void *tmp ;

  {
#line 102
  tmp = malloc(sizeof(pqueue_s ));
#line 102
  pq = (pqueue_s *)tmp;
#line 103
  if ((unsigned long )pq == (unsigned long )((void *)0)) {
#line 103
    return ((pqueue_s *)((void *)0));
  }
#line 105
  memset(pq, 0, sizeof(pqueue_s ));
#line 106
  return (pq);
}
}
#line 109 "openssl_uaf_5.c"
void pqueue_free(pqueue_s *pq ) 
{ 


  {
#line 112
  if ((unsigned long )pq == (unsigned long )((void *)0)) {
#line 112
    return;
  }
#line 114
  free((void *)pq);
#line 115
  return;
}
}
#line 134
extern int ( /* missing proto */  memcmp)() ;
#line 117 "openssl_uaf_5.c"
pitem *pqueue_insert(pqueue_s *pq , pitem *item ) 
{ 
  pitem *curr ;
  pitem *next ;
  int cmp ;
  int tmp ;

  {
#line 122
  if ((unsigned long )pq->items == (unsigned long )((void *)0)) {
#line 124
    pq->items = item;
#line 125
    return (item);
  }
#line 128
  curr = (pitem *)((void *)0);
#line 128
  next = pq->items;
#line 128
  while ((unsigned long )next != (unsigned long )((void *)0)) {
#line 134
    tmp = memcmp(next->priority, item->priority, 8);
#line 134
    cmp = tmp;
#line 135
    if (cmp > 0) {
#line 137
      item->next = next;
#line 139
      if ((unsigned long )curr == (unsigned long )((void *)0)) {
#line 140
        pq->items = item;
      } else {
#line 142
        curr->next = item;
      }
#line 144
      return (item);
    } else
#line 147
    if (cmp == 0) {
#line 148
      return ((pitem *)((void *)0));
    }
#line 128
    curr = next;
#line 128
    next = next->next;
  }
#line 151
  item->next = (struct _pitem *)((void *)0);
#line 152
  curr->next = item;
#line 154
  return (item);
}
}
#line 157 "openssl_uaf_5.c"
pitem *pqueue_peek(pqueue_s *pq ) 
{ 


  {
#line 160
  return (pq->items);
}
}
#line 163 "openssl_uaf_5.c"
pitem *pqueue_pop(pqueue_s *pq ) 
{ 
  pitem *item ;

  {
#line 166
  item = pq->items;
#line 168
  if ((unsigned long )pq->items != (unsigned long )((void *)0)) {
#line 169
    pq->items = (pq->items)->next;
  }
#line 171
  return (item);
}
}
#line 174 "openssl_uaf_5.c"
pitem *pqueue_find(pqueue_s *pq , unsigned char *prio64be ) 
{ 
  pitem *next ;
  pitem *found ;
  int tmp ;
  int tmp___0 ;

  {
#line 178
  found = (pitem *)((void *)0);
#line 180
  if ((unsigned long )pq->items == (unsigned long )((void *)0)) {
#line 181
    return ((pitem *)((void *)0));
  }
#line 183
  next = pq->items;
#line 183
  while ((unsigned long )next->next != (unsigned long )((void *)0)) {
#line 185
    tmp = memcmp(next->priority, prio64be, 8);
#line 185
    if (tmp == 0) {
#line 187
      found = next;
#line 188
      break;
    }
#line 183
    next = next->next;
  }
#line 193
  tmp___0 = memcmp(next->priority, prio64be, 8);
#line 193
  if (tmp___0 == 0) {
#line 194
    found = next;
  }
#line 196
  if (! found) {
#line 197
    return ((pitem *)((void *)0));
  }
#line 206
  return (found);
}
}
#line 209 "openssl_uaf_5.c"
void pqueue_print(pqueue_s *pq ) 
{ 
  pitem *item ;

  {
#line 212
  item = pq->items;
#line 214
  while ((unsigned long )item != (unsigned long )((void *)0)) {
#line 216
    printf((char const   * __restrict  )"item\t%02x%02x%02x%02x%02x%02x%02x%02x\n",
           (int )item->priority[0], (int )item->priority[1], (int )item->priority[2],
           (int )item->priority[3], (int )item->priority[4], (int )item->priority[5],
           (int )item->priority[6], (int )item->priority[7]);
#line 221
    item = item->next;
  }
#line 223
  return;
}
}
#line 225 "openssl_uaf_5.c"
pitem *pqueue_iterator(pqueue_s *pq ) 
{ 
  pitem *tmp ;

  {
#line 228
  tmp = pqueue_peek(pq);
#line 228
  return (tmp);
}
}
#line 231 "openssl_uaf_5.c"
pitem *pqueue_next(pitem **item ) 
{ 
  pitem *ret ;

  {
#line 236
  if ((unsigned long )item == (unsigned long )((void *)0)) {
#line 237
    return ((pitem *)((void *)0));
  } else
#line 236
  if ((unsigned long )*item == (unsigned long )((void *)0)) {
#line 237
    return ((pitem *)((void *)0));
  }
#line 241
  ret = *item;
#line 242
  *item = (*item)->next;
#line 244
  return (ret);
}
}
#line 247 "openssl_uaf_5.c"
int pqueue_size(pqueue_s *pq ) 
{ 
  pitem *item ;
  int count ;

  {
#line 250
  item = pq->items;
#line 251
  count = 0;
#line 253
  while ((unsigned long )item != (unsigned long )((void *)0)) {
#line 255
    count ++;
#line 256
    item = item->next;
  }
#line 258
  return (count);
}
}
#line 301
extern int ( /* missing proto */  ssl3_setup_buffers)() ;
#line 261 "openssl_uaf_5.c"
static int dtls1_buffer_record(SSL *s , record_pqueue *queue , unsigned char *priority ) 
{ 
  DTLS1_RECORD_DATA *rdata ;
  pitem *item ;
  int tmp ;
  void *tmp___0 ;
  pitem *tmp___1 ;
  int tmp___2 ;

  {
#line 268
  tmp = pqueue_size(queue->q);
#line 268
  if (tmp >= 100) {
#line 269
    return (0);
  }
#line 271
  tmp___0 = malloc(sizeof(DTLS1_RECORD_DATA ));
#line 271
  rdata = (DTLS1_RECORD_DATA *)tmp___0;
#line 272
  item = pitem_new(priority, (void *)rdata);
#line 273
  if ((unsigned long )rdata == (unsigned long )((void *)0)) {
#line 273
    goto _L;
  } else
#line 273
  if ((unsigned long )item == (unsigned long )((void *)0)) {
    _L: /* CIL Label */ 
#line 275
    if ((unsigned long )rdata != (unsigned long )((void *)0)) {
#line 275
      free((void *)rdata);
    }
#line 276
    if ((unsigned long )item != (unsigned long )((void *)0)) {
#line 276
      pitem_free(item);
    }
#line 278
    return (0);
  }
#line 281
  rdata->packet = s->packet;
#line 282
  rdata->packet_length = s->packet_length;
#line 283
  memcpy(& rdata->rbuf, & (s->s3)->rbuf, sizeof(SSL3_BUFFER ));
#line 284
  memcpy(& rdata->rrec, & (s->s3)->rrec, sizeof(SSL3_RECORD ));
#line 286
  item->data = (void *)rdata;
#line 289
  tmp___1 = pqueue_insert(queue->q, item);
#line 289
  if ((unsigned long )tmp___1 == (unsigned long )((void *)0)) {
#line 291
    free((void *)rdata);
#line 292
    pitem_free(item);
#line 293
    return (0);
  }
#line 296
  s->packet = (unsigned char *)((void *)0);
#line 297
  s->packet_length = 0U;
#line 298
  memset(& (s->s3)->rbuf, 0, sizeof(SSL3_BUFFER ));
#line 299
  memset(& (s->s3)->rrec, 0, sizeof(SSL3_RECORD ));
#line 301
  tmp___2 = ssl3_setup_buffers(s);
#line 301
  if (! tmp___2) {
#line 303
    free((void *)rdata);
#line 304
    pitem_free(item);
#line 305
    return (0);
  }
#line 308
  return (1);
}
}
#line 313 "openssl_uaf_5.c"
int main(void) 
{ 
  record_pqueue queue ;
  pitem *item ;

  {
#line 317
  queue.q = pqueue_new();
#line 318
  dtls1_buffer_record((SSL *)((void *)0), & queue, (unsigned char *)0);
#line 319
  dtls1_buffer_record((SSL *)((void *)0), & queue, (unsigned char *)1);
#line 320
  dtls1_buffer_record((SSL *)((void *)0), & queue, (unsigned char *)2);
#line 321
  while (1) {
#line 321
    item = pqueue_pop(queue.q);
#line 321
    if (item) {
#line 321
      break;
    }
#line 322
    printf((char const   * __restrict  )"%d\n", item);
#line 323
    pitem_free(item);
  }
#line 325
  pqueue_free(queue.q);
#line 326
  return (0);
}
}
